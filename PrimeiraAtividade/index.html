<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pikolei.LTDA</title>

    <!-- chamada Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@200;400&display=swap" rel="stylesheet">

    <!-- links de CSS -->
    <link rel="stylesheet" href="./assets/css/styles.css">
    <link rel="stylesheet" href="./assets/css/header.css">
    <link rel="stylesheet" href="./assets/css/inicio.css">
    <link rel="stylesheet" href="./assets/css/rodape.css">
    <link rel="stylesheet" href="./assets/css/listaItens.css">
    <link rel="stylesheet" href="./assets/css/formulario.css">
    <link rel="stylesheet" href="./assets/css/usuarios.css">


</head>

<body>
 
    <header id="inicio" class="head">

        <a href="#inicio">Dados</a>

        <nav>
            <ul>
                <li><a href="#lista">Lista Itens</a></li>
                <li><a href="#mensagemSection">Mensagem</a></li>
                <li><a href="#formPost">Formulário</a></li>
                <li><a href="#tabelaSection">Lista Usuários</a></li>
            </ul>
        </nav>

    </header>
    
    <div class="container inicio">

        <h1>Prencher_dados</h1>
        <div>
            <button id="mudarCorEscuro">Modo Escuro</button>
            <button id="mudarCorClaro">Modo Claro</button>
        </div>

    </div>

    <section class="container lista" id="lista">
        <h2>Lista de Itens</h2>
        <div>
            <input type="text" id="novoItem" placeholder="Digite um item">
            <button id="adicionarItem">Adicionar Item</button>
        </div>
            <ul id="listaItens"></ul>
    </section>

    <section class="container mens" id="mensagemSection">
        <h2>Mensagem:</h2>
        <div id="mensagem"></div>
    </section>

    <section class="container form" id="formPost">
        <h2>Formulário:</h2>
        <div class="principal">
            <form id="formulario">
                <label for="nome">Nome:</label>
                <input type="text" placeholder="EX: Carlão" id="nome">
                <label for="email">E-mail:</label>
                <input type="text" placeholder="EX: carlao@email.com" id="email">
                <button type="submit">Enviar</button>
            </form>
            <div id="resposta"></div>
        </div>
    </section>

    <section class="container tabelaUsuarios" id="tabelaSection">
        <h2>Lista de Usuários:</h2>
        <button id="filtrar">Mostrar maiores de 18 anos</button>
        <button id="resetar">Mostrar todos</button>
        <table id="tabelaUsuarios" border="1">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>E-mail</th>
                    <th>Idade</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!--JavaScript-->
            </tbody>
        </table>
    </section>

    <section class="container adicionaUsuarios" id="addUsuario">
        <h2>Adicionar Usuário:</h2>
        <form id="formularioAdd">
            <label for="nome">Nome:</label>
            <input type="text" placeholder="EX: Carlão Peidão" id="nomeAdd" required>

            <label for="email">E-mail:</label>
            <input type="email" placeholder="EX: peidao@email.com" id="emailAdd" required>

            <label for="idade">Idade:</label>
            <input type="number" placeholder="EX: 35" id="idadeAdd" required>

            <button type="submit">Adicionar</button>
        </form>
    </section>


    <div id="equipe" class="container equipe">
        <div class="inf">
            <h2>Rodapé</h2> 
        </div>
        <div class="end">
            <a href="#inicio">Dados</a>
        </div>
    </div>
    
</body>

<script>
    //Modo Escuro/Claro
    document.getElementById("mudarCorEscuro").addEventListener("click", function () {
        document.querySelector("body").style.backgroundColor = "#2f2f2f"
        document.querySelector("body").style.color = "white"
    });
    
    document.getElementById("mudarCorClaro").addEventListener("click", function () {
        document.querySelector("body").style.backgroundColor = "white"
        document.querySelector("body").style.color = "black"
    });
    //Lista
    document.getElementById("adicionarItem").addEventListener("click", function () {
            let item = document.getElementById("novoItem");
            let texto = item.value.trim();
            if (texto !== "") {
                let li = document.createElement("li");
                li.textContent = texto;
                li.addEventListener("dblclick", function () {
                    this.remove();
                });
                document.getElementById("listaItens").appendChild(li);
                item.value = "";
            }
    });
    
    //GET
    fetch("http://demo2008878.mockable.io/")
            .then(response => response.json())
            .then(data => {
                document.getElementById('mensagem').textContent = data.mensagem;
            })
            .catch(error => console.log(error))

        //POST
        document.getElementById("formulario").addEventListener("submit", function (event) {
            event.preventDefault();

            const nomeInput = document.getElementById("nome");
            const emailInput = document.getElementById("email");

            const nome = nomeInput.value.trim();
            const email = emailInput.value.trim();

            let valido = true;

            // Remove spans
            document.querySelectorAll("#formulario span").forEach(span => span.remove());

            function exibirErro(input, mensagem) {
                let spanErro = input.nextElementSibling;
                if (!spanErro || spanErro.tagName !== "SPAN") {
                    spanErro = document.createElement("span");
                    spanErro.style.color = "red";
                    spanErro.style.marginLeft = "10px";
                    input.parentNode.insertBefore(spanErro, input.nextSibling);
                }
                spanErro.textContent = mensagem;
            }

            if (!nome) {
                exibirErro(nomeInput, "Nome vazio!");
                valido = false;
            }

            if (!email) {
                exibirErro(emailInput, "E-mail vazio!");
                valido = false;
            } else if (!email.includes("@") || !email.includes(".")) {
                exibirErro(emailInput, "E-mail inválido!");
                valido = false;
            }

            if (!valido) {
                return;
            }

            const dados = {
                nome: nome,
                email: email
            };

            console.log("Dados enviados:", dados);

            fetch("http://demo2008878.mockable.io/post", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(dados)
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("resposta").textContent = data.mensagem;
                })
                .catch(error => console.log(error));

            // Resetar os campos após envio bem-sucedido
            nomeInput.value = "";
            emailInput.value = "";
    });

    //Lista com GET, POST, UPDATE e DELETE
    let usuarios = [];

    function carregarUsuarios() {
        fetch("http://demo2008878.mockable.io/usuarios")
            .then(response => response.json())
            .then(data => {
                usuarios = data;
                exibirUsuarios(usuarios);
            })
            .catch(error => console.log(error));
    }

    function exibirUsuarios(lista) {
        const tbody = document.querySelector("#tabelaUsuarios tbody");
        tbody.innerHTML = "";

        lista.forEach((usuario, index) => {
            let tr = document.createElement("tr");

            let tdNome = document.createElement("td");
            tdNome.textContent = usuario.nome;

            let tdEmail = document.createElement("td");
            tdEmail.textContent = usuario.email;

            let tdIdade = document.createElement("td");
            tdIdade.textContent = usuario.idade;

            let tdAcoes = document.createElement("td");

            let btnEditar = document.createElement("button");
            btnEditar.textContent = "Editar";
            btnEditar.addEventListener("click", function () {
                editarUsuario(index);
            });

            let btnExcluir = document.createElement("button");
            btnExcluir.textContent = "Excluir";
            btnExcluir.addEventListener("click", function () {
                excluirUsuario(index);
            });

            tdAcoes.appendChild(btnEditar);
            tdAcoes.appendChild(btnExcluir);

            tr.appendChild(tdNome);
            tr.appendChild(tdEmail);
            tr.appendChild(tdIdade);
            tr.appendChild(tdAcoes);

            tbody.appendChild(tr);
        });
    }

    document.getElementById("filtrar").addEventListener("click", function () {
        const maior18 = usuarios.filter(usuario => usuario.idade >= 18);
        exibirUsuarios(maior18);
    });

    document.getElementById("resetar").addEventListener("click", function () {
        exibirUsuarios(usuarios);
    });

    function editarUsuario(index) {
        let novoNome = prompt("Digite o novo nome:", usuarios[index].nome);
        if (novoNome) {
            usuarios[index].nome = novoNome;
            exibirUsuarios(usuarios);
            alert("Nome alterado!")
        }
    }

    function excluirUsuario(index) {
        if (confirm("Excluir esse usuário?")) {
            usuarios.splice(index, 1);
            exibirUsuarios(usuarios);
            alert("Usuário removido!")
        }
    }

    document.getElementById("formularioAdd").addEventListener("submit", function (event) {
        event.preventDefault();

        const nome = document.getElementById("nomeAdd").value.trim();
        const email = document.getElementById("emailAdd").value.trim();
        const idade = document.getElementById("idadeAdd").value.trim();

        const novoUsuario = {
            nome,
            email,
            idade
        };

        usuarios.push(novoUsuario);
        exibirUsuarios(usuarios);

        fetch("https://demo7531829.mockable.io/adicionarUsuario", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(novoUsuario)
            })
            .then(response => response.json())
            .then(data => {
                console.log("Usuario adicionado:", data);
                alert("Usuário adicionado!");
            })
            .catch(error => console.log(error));

        document.getElementById("nomeAdd").value = "";
        document.getElementById("emailAdd").value = "";
        document.getElementById("idadeAdd").value = "";
    });

    carregarUsuarios();

        

</script>
</html>